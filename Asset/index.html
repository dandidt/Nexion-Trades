<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Image Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Roboto", sans-serif;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .upload-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .canvas-container {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            margin-bottom: 20px;
        }
        
        canvas {
            max-width: 100%;
            max-height: 500px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-copy {
            background: #4CAF50;
            color: white;
        }
        
        .btn-copy:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn-download {
            background: #2196F3;
            color: white;
        }
        
        .btn-download:hover {
            background: #0b7dda;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvasShare"></canvas>
        </div>
        
        <div class="action-buttons">
            <button class="btn btn-copy" onclick="copyImage()">
                ðŸ“‹ Copy Image
            </button>
            <button class="btn btn-download" onclick="downloadImage()">
                ðŸ’¾ Download Image
            </button>
        </div>
    </div>

    <script>
        const canvasShare = document.getElementById('canvasShare');
        const ctxShare = canvasShare.getContext('2d');
        let templateImage = null;

        // ====================================
        // KONFIGURASI - EDIT DI SINI
        // ====================================

        const TEMPLATE_PATH = 'template.png';
        
        const TEXT_CONTENT = {
            text1: '+$83K',
            text2: '+$3.324%',
            text3: '$3.32K',
            text4: '$643.43K',
            text5: '342'
        };
        
        const TEXT_POSITIONS = {
            text1: [205, 428],
            text2: [790, 550],
            text3: [790, 640],
            text4: [790, 730],
            text5: [790, 820]
        };
        
        const FONT_SIZE = 50;
        const LINE_HEIGHT = 30;
        const TEXT_COLOR = '#ffffff';

        // === STYLE KHUSUS UNTUK MASING-MASING GRUP TEKS ===
        const STYLE_TEXT1 = {
            font: `900 170px Roboto`,
            gradient: ['#ffffff', '#63cdc6'],
            letterSpacing: 4.5,
            align: 'left'
        };

        const STYLE_TEXT2 = {
            font: `800 ${FONT_SIZE}px Roboto`,
            color: '#29e1c7',
            letterSpacing: 2,
            align: 'right'
        };

        const STYLE_DEFAULT = {
            font: `800 ${FONT_SIZE}px Roboto`,
            color: TEXT_COLOR,
            letterSpacing: 2,
            align: 'right'
        };

        // ====================================
        // END KONFIGURASI
        // ====================================

        function loadTemplate() {
            const img = new Image();
            img.onload = function() {
                templateImage = img;
                canvasShare.width = img.width;
                canvasShare.height = img.height;
                drawCanvasShare();
            };

            img.onerror = function() {
                canvasShare.width = 800;
                canvasShare.height = 600;
                ctxShare.fillStyle = '#ff0000';
                ctxShare.font = '20px Roboto';
                ctxShare.textAlign = 'center';
                ctxShare.fillText('Error: template.png tidak ditemukan!', canvasShare.width / 2, canvasShare.height / 2);
                ctxShare.fillText('Pastikan file template.png ada di folder yang sama', canvasShare.width / 2, canvasShare.height / 2 + 30);
            };
            img.src = TEMPLATE_PATH;
        }
        
        loadTemplate();

        // ====================================
        // ðŸ”  Fungsi untuk menulis teks dengan letterSpacing yang stabil
        // ====================================
        function drawTextWithLetterSpacing(ctxShare, text, x, y, letterSpacing = 0, style) {
            ctxShare.font = style.font;
            ctxShare.textAlign = 'left';

            // Setup fill style
            let fillStyle = style.color || '#fff';
            if (style.gradient) {
                // Ukur tinggi perkiraan teks (gunakan fontSize dari font, atau estimasi)
                const fontSizeMatch = style.font.match(/(\d+)px/);
                const fontSize = fontSizeMatch ? parseInt(fontSizeMatch[1], 10) : 50;
                const textHeight = fontSize; // cukup akurat untuk kebanyakan kasus

                const gradient = ctxShare.createLinearGradient(x, y - textHeight, x, y);
                style.gradient.forEach((c, i, arr) => {
                    gradient.addColorStop(i / (arr.length - 1), c);
                });
                fillStyle = gradient;
            }
            ctxShare.fillStyle = fillStyle;

            // Hitung total lebar untuk alignment
            const charWidths = Array.from(text).map(ch => ctxShare.measureText(ch).width);
            const totalWidth = charWidths.reduce((sum, w) => sum + w, 0) + letterSpacing * (text.length - 1);

            // Tentukan posisi awal berdasarkan alignment
            let currentX = x;
            if (style.align === 'center') {
                currentX -= totalWidth / 2;
            } else if (style.align === 'right') {
                currentX -= totalWidth;
            }

            // Gambar tiap karakter
            for (let i = 0; i < text.length; i++) {
                const ch = text[i];
                ctxShare.fillText(ch, currentX, y);
                currentX += charWidths[i] + letterSpacing;
            }
        }

        function drawCanvasShare() {
            if (!templateImage) return;
            
            ctxShare.clearRect(0, 0, canvasShare.width, canvasShare.height);
            ctxShare.drawImage(templateImage, 0, 0);

            // ========== TEXT 1 (Special Style + Background Box with Padding & Vertical Center) ==========
            const text1 = TEXT_CONTENT.text1;
            const [origX, origY] = TEXT_POSITIONS.text1;
            if (text1) {
                const style = STYLE_TEXT1;
                ctxShare.font = style.font;
                const letterSpacing = style.letterSpacing || 0;

                // Ukur lebar teks karakter per karakter
                const charWidths = Array.from(text1).map(ch => ctxShare.measureText(ch).width);
                const totalTextWidth = charWidths.reduce((sum, w) => sum + w, 0) + letterSpacing * (text1.length - 1);

                // Estimasi tinggi teks (ascent + descent)
                const fontSizeMatch = style.font.match(/(\d+)px/);
                const fontSize = fontSizeMatch ? parseInt(fontSizeMatch[1], 10) : 170;
                
                // Gunakan metrik font modern jika tersedia
                let textAscent, textDescent;
                if (ctxShare.measureText && ctxShare.measureText('M').fontBoundingBoxAscent !== undefined) {
                    const metrics = ctxShare.measureText('M');
                    textAscent = metrics.fontBoundingBoxAscent;
                    textDescent = metrics.fontBoundingBoxDescent;
                } else {
                    // Fallback: estimasi umum untuk Roboto
                    textAscent = fontSize * 0.8;
                    textDescent = fontSize * 0.2;
                }
                const textHeight = textAscent + textDescent;

                // Padding sesuai permintaan: 10px atas-bawah, 20px kiri-kanan
                const paddingX = 40;
                const paddingY = 10;
                const borderRadius = 50;

                // Lebar & tinggi box
                const boxWidth = totalTextWidth + 2 * paddingX;
                const boxHeight = textHeight + 2 * paddingY;

                // Posisi box: kiri = origX - paddingX, atas = (origY - textAscent) - paddingY
                // Tapi karena kita ingin teks **center**, kita hitung dari tengah
                const boxX = origX - paddingX;
                const boxY = origY - textAscent - paddingY; // posisi atas box

                // === Gambar background ===
                ctxShare.fillStyle = 'rgba(0, 144, 163, 0.1)';
                ctxShare.beginPath();
                if (ctxShare.roundRect) {
                    ctxShare.roundRect(boxX, boxY, boxWidth, boxHeight, borderRadius);
                } else {
                    // Fallback sederhana tanpa radius jika perlu (atau gunakan fungsi roundRect custom)
                    ctxShare.rect(boxX, boxY, boxWidth, boxHeight);
                }
                ctxShare.fill();

                // === Gambar border ===
                ctxShare.strokeStyle = 'rgba(0, 144, 163, 0.25)';
                ctxShare.lineWidth = 1;
                ctxShare.stroke();

                // === Gambar teks: posisi y = boxY + paddingY + textAscent ===
                const textDrawY = boxY + paddingY + textAscent;
                drawTextWithLetterSpacing(ctxShare, text1, boxX + paddingX, textDrawY, letterSpacing, style);
            }
            // ========== TEXT 2â€“5 ==========
            for (let i = 2; i <= 5; i++) {
                const text = TEXT_CONTENT[`text${i}`];
                const [x, y] = TEXT_POSITIONS[`text${i}`];
                if (!text) continue;

                const style = i === 2 ? STYLE_TEXT2 : STYLE_DEFAULT;
                const lines = text.split('\n');
                lines.forEach((line, index) => {
                    const yPos = y + (index * LINE_HEIGHT);
                    drawTextWithLetterSpacing(ctxShare, line, x, yPos, style.letterSpacing, style);
                });
            }
        }

        async function copyImage() {
            try {
                const blob = await new Promise(resolve => canvasShare.toBlob(resolve, 'image/png'));
                await navigator.clipboard.write([
                    new ClipboardItem({ 'image/png': blob })
                ]);
            } catch (err) {
                return;
            }
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'template-edited.png';
            link.href = canvasShare.toDataURL('image/png');
            link.click();
        }

        canvasShare.width = 800;
        canvasShare.height = 600;
        ctxShare.fillStyle = '#f0f0f0';
        ctxShare.fillRect(0, 0, canvasShare.width, canvasShare.height);
        ctxShare.fillStyle = '#999';
        ctxShare.font = '20px Roboto';
        ctxShare.textAlign = 'center';
        ctxShare.fillText('Loading template.png...', canvasShare.width / 2, canvasShare.height / 2);
    </script>

</body>
</html>