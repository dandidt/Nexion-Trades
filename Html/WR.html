<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart - Win/Lose/Missed</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'inner';
            background: linear-gradient(135deg, rgb(233, 233, 233) 0%, #b1b1b1 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: auto;
            color: rgb(206, 183, 50);
        }
    </style>
</head>
<body>
<canvas id="donutChart"></canvas>
<script>
const canvasWrChart = document.getElementById('donutChart');
const ctxWrChart = canvasWrChart.getContext('2d');

// Ukuran canvas
canvasWrChart.width = 600;
canvasWrChart.height = 450;

// Hitung posisi center otomatis
const centerX = canvasWrChart.width / 2;
const centerY = canvasWrChart.height / 2;

const radius = 120;
const holeRadius = 75;

const dataWrChart = [
    { label: 'Win', value: 445, color1: '#34d399', color2: '#2D7D60' },
    { label: 'Lose', value: 543, color1: '#fb7185', color2: '#bb3747' },
    { label: 'Missed', value: 60, color1: '#e7e7e7', color2: '#d1d1d1' }
];

const total = dataWrChart.reduce((sum, item) => sum + item.value, 0);

let animationProgress = 0;
const animationDuration = 1500;
let startTime = null;

function createLinearGradientWrChart(color1, color2) {
    const grad = ctxWrChart.createLinearGradient(
        centerX - radius,
        centerY - radius,
        centerX + radius,
        centerY + radius
    );
    grad.addColorStop(0, color1);
    grad.addColorStop(1, color2);
    return grad;
}

function drawDonutSegment(startAngle, endAngle, color1, color2) {
    ctxWrChart.beginPath();
    ctxWrChart.arc(centerX, centerY, radius, startAngle, endAngle);
    ctxWrChart.arc(centerX, centerY, holeRadius, endAngle, startAngle, true);
    ctxWrChart.closePath();

    const gradient = createLinearGradientWrChart(color1, color2);
    ctxWrChart.fillStyle = gradient;

    ctxWrChart.shadowColor = 'rgba(0, 0, 0, 0.15)';
    ctxWrChart.shadowBlur = 12;
    ctxWrChart.shadowOffsetX = 0;
    ctxWrChart.shadowOffsetY = 4;
    ctxWrChart.fill();
    ctxWrChart.shadowColor = 'transparent';
}

function drawLabelWrChart(item, startAngle, endAngle, delay) {
    const progress = Math.max(0, Math.min(1, (animationProgress - delay) / 500));
    if (progress <= 0) return;

    const midAngle = startAngle + (endAngle - startAngle) / 2;

    // Titik mulai: nempel chart
    const lineStartX = centerX + Math.cos(midAngle) * radius;
    const lineStartY = centerY + Math.sin(midAngle) * radius;

    let lineMidX, lineMidY, lineEndX, lineEndY, textX, align;
    const isRightSide = Math.cos(midAngle) > 0;

    if (isRightSide) {
        lineMidX = lineStartX + 25;
        lineMidY = lineStartY + (item.label === 'Win' ? -30 : 30);
        lineEndX = canvasWrChart.width - 40;
        lineEndY = lineMidY;
        textX = lineEndX - 10;
        align = 'right';
    } else {
        lineMidX = lineStartX - 25;
        lineMidY = lineStartY - 20;
        lineEndX = 40;
        lineEndY = lineMidY;
        textX = lineEndX + 10;
        align = 'left';
    }

    // Garis label
    ctxWrChart.strokeStyle = item.color2;
    ctxWrChart.lineWidth = 2;
    ctxWrChart.globalAlpha = progress;
    ctxWrChart.beginPath();
    ctxWrChart.moveTo(lineStartX, lineStartY);
    ctxWrChart.lineTo(lineMidX, lineMidY);
    ctxWrChart.lineTo(lineEndX, lineEndY);
    ctxWrChart.stroke();

    // Titik ujung
    ctxWrChart.fillStyle = item.color1;
    ctxWrChart.beginPath();
    ctxWrChart.arc(lineEndX, lineEndY, 4, 0, Math.PI * 2);
    ctxWrChart.fill();

    // Text value
    ctxWrChart.textAlign = align;
    ctxWrChart.fillStyle = 'rgb(245, 245, 245)';
    ctxWrChart.font = 'bold 22px Arial';
    ctxWrChart.fillText(item.value.toLocaleString('id-ID'), textX, lineEndY - 10);

    // Text label
    ctxWrChart.fillStyle = 'rgb(163, 163, 163)';
    ctxWrChart.font = '600 16px Arial';
    ctxWrChart.fillText(item.label, textX, lineEndY + 18);

    ctxWrChart.globalAlpha = 1;
}

function drawCenterText() {
    const progress = Math.max(0, Math.min(1, (animationProgress - 1200) / 300));
    if (progress <= 0) return;

    ctxWrChart.globalAlpha = progress;

    ctxWrChart.fillStyle = 'rgb(245, 245, 245)';
    ctxWrChart.font = 'bold 25px Arial';
    ctxWrChart.textAlign = 'center';
    ctxWrChart.fillText(total.toLocaleString('id-ID'), centerX, centerY + 10);

    ctxWrChart.globalAlpha = 1;
}

function animateWrChart(timestamp) {
    if (!startTime) startTime = timestamp;
    animationProgress = timestamp - startTime;

    ctxWrChart.clearRect(0, 0, canvasWrChart.width, canvasWrChart.height);

    let currentAngle = -Math.PI / 2;
    let progress = Math.min(1, animationProgress / animationDuration);

    progress = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);

    dataWrChart.forEach((item, index) => {
        const sliceAngle = (item.value / total) * Math.PI * 2;
        const endAngle = currentAngle + sliceAngle * progress;

        const itemDelay = index * 300;
        const itemProgress = Math.max(0, Math.min(1, (animationProgress - itemDelay) / 800));

        if (itemProgress > 0) {
            const animateWrChartdEndAngle = currentAngle + sliceAngle * itemProgress;
            drawDonutSegment(currentAngle, animateWrChartdEndAngle, item.color1, item.color2);
        }

        if (itemProgress >= 0.8) {
            drawLabelWrChart(item, currentAngle, currentAngle + sliceAngle, 1000 + index * 300);
        }

        currentAngle += sliceAngle;
    });

    drawCenterText();

    if (animationProgress < animationDuration + 1500) {
        requestAnimationFrame(animateWrChart);
    }
}

requestAnimationFrame(animateWrChart);
</script>


</body>
</html>
